\section{Estimación de la velocidad de los motores del robot}\label{ch:estimacionVelocdida}
La estimación de la velocidad se realiza con encoders ópticos. Es necesario calibrar los encoders primero para después diseñar el control de velocidad de las ruedas.

\subsection{Encoders ópticos}\label{sc:encoderOptico}
Un encoder óptico detecta, con ayuda de una rueda ranurada, el paso de luz o no mediante un fotodiodo que incorpora el encoder y un transistor con la base expuesta. A la salida devuelven un valor alto de voltaje si no se ha detectado luz o un valor bajo de voltaje si se ha detectado luz, en la figura ~\ref{fig:encoderrobot} se puede apreciar la rueda ranurada y como está colocado el encoder en el robot. Los encoders como tal no pueden contar pulsos o medir la velocidad, esto se hace con ayuda de la placa de Arduino, la cual se ha configurado para que actúe mediante interrupciones a las variaciones de voltaje que proporciona la salida digital del encoder, una interrupción es una parada de la rutina que se estuviese ejecutando y se ejecuta la rutina de la interrupción. Se hace con interrupciones es para tener mayor precisión en la estimación de la velocidad. 
\begin{figure}[h]
	\centering
	\includegraphics[width=0.45\linewidth]{ConstruccionRObot/EncoderRobot}
	\caption{Colocación del encoder}
	\label{fig:encoderrobot}
\end{figure}

La manera en que se estima la velocidad es midiendo el intervalo de tiempo entre interrupciones y en la misma rutina de interrupción se cuentan los pulsos, de esta manera se puede medir la distancia recorrida por cada rueda y estimar su velocidad. Como la rueda ranurada consta de 20 ranuras, es decir, se tiene una resolución de N=20, se puede hacer una división en radianes de la rueda de la siguiente manera:
\begin{equation}
\Delta\theta=\frac{2\pi}{20} 
\end{equation}
Conociendo las dimensiones de la rueda que dispone de un radio de  $r=3.35 cm$ se puede conocer la distancia que avanza cada rueda y por lo tanto la distancia recorrida por el robot. Como la distancia se puede relacionar con el ángulo de la rueda y el radio de la misma.
\begin{equation}
d=r\cdot\Delta\theta
\end{equation}

La mínima distancia que se puede medir es: 
\begin{equation}
d=3.35 \cdot\dfrac{2\pi}{20}=1.05cm
\end{equation}
 Es una resolución suficiente en comparación con las dimensiones de las ruedas, esta resolución también limita la precisión con la cual se obtienen los datos de los distintos experimentos que se realicen en el Robotario. La velocidad se calcula de la siguiente manera, tomando la inversa del tiempo entre pulsos($\Delta T$) y dividiendo entre la resolución de la rueda ranurada que es N=20, se tiene la frecuencia a la cual gira la rueda, si la frecuencia $\frac{1}{N \Delta T}$ se multiplica por $2\pi$, se tiene la velocidad angular a la cual gira la rueda.
 \begin{equation}
 W=\frac{2\pi}{N \Delta T}
 \end{equation}


\subsection{Limitación de la alimentación del motor}\label{ch:controlmotorLimitacion}
El integrado Ln298n proporciona al motor un voltaje máximo de 9V procedente de la batería, haciendo que los motores lleguen a saturación y tengan una velocidad máxima de 30 $rad/s$ que equivale a $100.5$ $cms/s$ y una mínima necesaria para vencer el rozamiento estático inicial de 7.5 $rad/s$ que equivale a $28.48$ $cm/s$, que se logra con un voltaje de 3 voltios aproximadamente. Una vez está en movimiento y se ha vencido el rozamiento estático, se llega a velocidades mínimas de 4-5 $rad/s$ que equivale a $13.4$ $cm/s$ y $16.75$ $cm/s$. Esto se debe a que para vencer el rozamiento inicial, cuando el robot se encuentra parado, se necesita más energía. Está limitación en la velocidad inicial deja una zona muerta amplia del motor que se debe tener en cuenta en el control. Estos margenes de velocidades no interesan, pues el espacio que se tiene es limitado y una velocidad alta del robot provoca que en un espacio reducido no se puedan apreciar los movimientos que realiza y no se pueda analizar los resultados de manera adecuada.\\

Se reduce el voltaje que alimenta el módulo L298n mediante un conversor DC-DC. Se regula para que proporcione un voltaje de alimentación de 6.5V, con una entrada de 9.9 V. La regulación del voltaje está cuantizada como se detalla en el capítulo~\ref{ch:ControlMotor} y, al reducir el voltaje máximo, se consigue tener más niveles de voltajes en rangos menores esto se debe a que se ha desplazado el fondo de escala. También se aumenta la resolución para tener más  velocidades pequeñas. Ahora se tienen niveles de velocidad más bajo, adecuados para las dimensiones del Robotario actual. De esta manera se aprovecha el espacio de manera más eficaz. Además con un nivel de tensión máximo más bajo, se evita que el motor pueda alcanzar la saturación y se logra aumentar la duración de la batería.\\

 Con esta nueva limitación del voltaje, la mínima velocidad a la cual la rueda empieza a girar para vencer el rozamiento estático es la misma que en el caso anterior. Para un voltaje de 6.5 voltios del motor que es el voltaje maximo impuesto, se obtiene una velocidad máxima de $15$ $rad/s$ que equivale a $50.25$ $cm/s$.\\
  La velocidad máxima de 15 $rad/s$ es la que va a condicionar el periodo de muestreo, pues como $15$ $rad/s= \frac{2·\pi}{20·Ts}$ donde $Ts$ es el tiempo entre pulsos, despejando se obtiene que $Ts=20.94 ms$ es decir que el tiempo de muestreo a partir del teorema de Nyquist debe de ser al menos menor que la mitad de este tiempo. Se elije un tiempo 4 veces menor, es decir $5 ms$. Tiempo adecuado para que la placa de Arduino pueda completar sus tareas.




\input{estimaVelocidad/TratamientoRuido/TratamientoDeRuido.tex}

