\section{Estimación de la velocidad}
La estimación de la velocidad se realiza con encoders ópticos, estos detectan con ayuda de una rueda ranurada el paso de luz o no mediante un fotodiodo que incorpora el encoder y un transistor con la base expuesta que reacciona a la luz, a la salida devuelven un valor alto de voltaje si no se ha detectado luz o un valor bajo de voltaje si se ha detectado luz, en la Figura ~\ref{fig:encoderrobot} se puede apreciar la rueda ranurada y como está colocado el encoder en el robot. Los encoders como tal no pueden contar pulsos o medir la velocidad, esto se hace con ayuda de la placa de Arduino, la cual se ha configurado para que actúe mediante interrupciones a las variaciones de voltaje que proporciona la salida digital del encoder, el porque se hace con interrupciones es para no mantener el procesador de la placa Arduino ocioso estimando la velocidad. 
		\begin{figure}[h]
	\centering
	\includegraphics[width=0.45\linewidth]{ConstruccionRObot/EncoderRobot}
	\caption{Colocación del encoder}
	\label{fig:encoderrobot}
\end{figure}


La manera en que se estima la velocidad es midiendo el intervalo de tiempo entre interrupciones y en la misma rutina de interrupción se cuentan los pulsos, de esta manera se puede medir la distancia recorrida por cada rueda y estimar la velocidad de cada rueda. La rueda ranurada como se ha comentado antes, consta de 20 ranuras,  esto implica que se tiene una resolución de N=20 y se divide la rueda en $\Delta\theta=\frac{2\pi}{20} $ radianes, conociendo las dimensiones de la rueda, la cual tiene un radio de $3.35 cm$ se puede conocer la distancia que avanza cada rueda y por lo tanto la distancia recorrida por el robot, la mínima distancia que se puede medir es $3.35 \cdot\dfrac{2\pi}{20}=1.05$ cm es una resolución suficiente en comparación con las dimensiones de las ruedas, esta resolución también limita la precisión con la cual se obtienen los datos de los distintos experimentos que se realicen en el robotario.\\


 La mínima velocidad de la rueda es de $7.5 rad/s$ que conociendo las dimensiones de la rueda equivale a $25.13 cm/s$, esta es la mínima velocidad de giro de la rueda que corresponde a un voltaje de 3 voltios, este es el voltaje necesario para que el motor empiece a girar y venza el rozamiento, y  para un voltaje de 6.5 voltios del motor que es el voltaje maximo impuesto por mi, se obtiene una velocidad máxima de $15rad/s$. El porque se elige este voltaje y no otro como máximo está relacionado con la velocidad máxima que se desea y con la resolución de voltaje que se tiene para velocidades menores, como se comenta en el capítulo ~\ref{ch:ControlMotor} el voltaje esta cuantizado, si se reduce el fondo de escala, se tiene más valores discretos de voltajes menores, que esto equivale a niveles de velocidad más bajo , que para las dimensiones del robotario actual es necesario reducir  la velocidad máxima, de esta manera se aprovecha el espacio de manera más eficaz, además con un nivel de tensión mas bajo, se evita que el motor pueda alcanzar la saturación y se logra aumentar la duración de la batería.  Esta velocidad máxima es la que va a condicionar mi periodo de muestreo pues como un $rad/s= \frac{2·\pi}{20·Ts}$ donde $Ts$ es el tiempo entre pulsos, despejando se obtiene que $Ts=20.96 ms$ es decir que mi tiempo de muestreo a partir del teorema de Nyquist debe de ser al menos menor que la mitad de este tiempo. Yo elijo un tiempo 3 veces menor es decir de $5 ms$ siendo este tiempo mínimo que he estimado que me permite Arduino tener corriendo su programa y realizando los cálculos correspondientes.








\clearpage\thispagestyle{empty}\cleardoublepage
\input{estimaVelocidad/TratamientoRuido/TratamientoDeRuido.tex}

