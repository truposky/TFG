\subsection{Cuantización del voltaje}

Para poder tener una velocidad determinada lo que se hace es dar un determinado voltaje al motor DC de cada rueda motriz, esto se hace mediante una señal PWM y un puente H para cada motor, como se ha comentado en la sección el capítulo ~\ref{ch:HardwareYsoftware} el puente H lo proporciona el módulo L298n y la señal PWM la proporciona la placa de Arduino.\\
\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{dutycicle}
	\caption{Variación del ciclo de trabajo}
	\label{fig:dutycicle}
\end{figure}

Una señal de PWM es una señal en la cual se modifica el ciclo de trabajo de una señal periódica, se usa para transmitir información o para regular la energía transmitida a una carga, en la la aplicación actual se usa para regular la cantidad de energía que se le entrega al motor y la señal periódica en este caso es una señal cuadrada. La manera en la cual se regula la cantidad de tensión que se le da al motor es cambiando el ciclo del trabajo de la señal cuadrada, es decir se le cambia el tiempo que permanece la señal en una tensión alta o positiva, en la Figura ~\ref{fig:dutycicle}, se puede ver como el ancho del pulso de la onda cuadrada cambia con los diferentes ciclos de trabajo y provoca que el voltaje promedio cambie, hay que señalar que solo se cambia el ancho de la onda pero no su periodo pues este es siempre el mismo. El ciclo de trabajo se suele expresa en porcentaje siendo el cálculo $D=\frac{T_{on}}{T}*100$, siendo T el periodo y $T_{on}$ el tiempo que la señal permanece en estado alto, el ciclo de trabajo permite cambiar el voltaje promedio de la señal\\
La señal PWM que genera Arduino es es digital y se genera con un contador de 8 bits una señal triangular y un comparador. El contador de 8 bits va aumentado el valor de 0 a 255, es decir tiene 256 niveles, cuando se supera el valor de 255 el contador vuelve a 0 y repite el ciclo.
\begin{figure}
	\centering
	\includegraphics[width=0.7\linewidth]{GeneradorDePWM}
	\caption{Señales de entrada al comparador}
	\label{fig:generadordepwm}
\end{figure}
En la figura ~\ref{fig:generadordepwm} se puede ver las señales de entrada al comparador, la salida del comparador es una onda cuadrada, que tiene un tiempo positivo igual al tiempo que la onda triangular permanece por encima del nivel del contador. De esta manera se genera una señal PWM en el arduino, esto implica que el voltaje esta cuantizado en 256 niveles y solo se puede variar en valores discretos de estos es decir la resolución de voltaje que se tiene es de $\frac{6.5 V}{256}=0.02V$ es una buena precisión, pero provocara oscilación respecto al valor de referencia, cuando se desee hacer un control de la velocidad que intente corregir el error entre la velocidad del robot y la velocidad de referencia.\\
La señal de PWM que proporciona Arduino es de control, el puente H proporciona la señal de potencia, de esta manera con una señal procedente de una placa con potencia se puede gobernar un motor que requiere mas potencia.
\begin{figure}[!h]
	\centering
	\includegraphics[width=0.7\linewidth]{controlMotor/PuenteH}
	\caption{Esquema del puente H}
	\label{fig:EsquemaPuenteH}
\end{figure}
Se explica como se gobierna la velocidad del motor y su sentido de giro, para ello se toma como referencia el puente H de la izquierda, que es el que está compuesto por 4 transistores y 4 puertas AND. La señal de control PWM entra por la entrada EnA, la señal para indicar el giro del motor proviene de in2 e in1, uno debe estar a 0 lógico y el otro a 1 lógico que corresponde  3.3 V, si los dos están al mismo valor el motor no gira, teniendo esto en cuenta cuando la señal procedente de arduino entra en  EnA y a su vez se tiene In1=1 e In2=0, el motor conectado a la salida out1 y out 2 gira en una dirección, es decir se permite el flujo de corriente desde el transistor superior izquierdo hasta el transistor inferior derecho, con voltaje promedio marcado por el ciclo de trabajo de la señal de PWM siendo la alimentación de la señal de potencia la correspondiente a la pata A que está conectado a Vs.
